"use strict";(()=>{var e={};e.id=90,e.ids=[90],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4271:(e,t,a)=>{a.r(t),a.d(t,{headerHooks:()=>m,originalPathname:()=>h,patchFetch:()=>g,requestAsyncStorage:()=>d,routeModule:()=>n,serverHooks:()=>p,staticGenerationAsyncStorage:()=>c,staticGenerationBailout:()=>f});var i={};a.r(i),a.d(i,{POST:()=>u});var r=a(5419),o=a(9108),s=a(9678);function l(e){return(e||"").toString().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g,"").trim().toLowerCase()}async function u(e){try{let t=await e.formData(),i=t.getAll("files[]"),r=t.get("comparacao");if(!i||4!==i.length||!r)return new Response(JSON.stringify({error:"Envie 4 relat\xf3rios do Meta e 1 planilha de compara\xe7\xe3o."}),{status:400});let o=async e=>Buffer.from(await e.arrayBuffer()),s=a(9077),u=[],n=1;for(let e of i){let t=await o(e),a=s.read(t,{type:"buffer"}),i=a.Sheets[a.SheetNames[0]],r=s.utils.sheet_to_json(i).map(e=>({nome:e["Nome da campanha"],inicio:e["In\xedcio dos relat\xf3rios"],resultados:Number(e.Resultados)||0,custo_por_resultados:Number(e["Custo por resultados"])||0})).filter(e=>e.nome&&e.inicio).map(e=>({...e,origem:`meta${n}`}));u=u.concat(r),n++}let d=await o(r),c=s.read(d,{type:"buffer"}),p=c.Sheets[c.SheetNames[0]],m=s.utils.sheet_to_json(p).map(e=>({titulo:e["T\xedtulo"],data_chegada:e["Data de chegada"],atividade_atual:e["Atividade atual"]})).filter(e=>e.titulo),f=m.filter(e=>l(e.titulo).startsWith("[4219]")).map(e=>({original:e.titulo,normalizado:l(e.titulo)})),h=Array.from(new Set(u.map(e=>e.nome))).map(e=>{let t=u.find(t=>t.nome===e),a=l(e),i=[],r=(i=a===l("villa gavea")?[]:a.includes(l("reserva dos passaros cod 4219"))?m.filter(e=>l(e.titulo).startsWith("[4219]")):a.includes(l("villa g\xe1vea cod 2772"))||a.includes(l("villa gavea cod 2772"))?m.filter(e=>l(e.titulo).startsWith("[2772]")):a.includes(l("villas do parque 2123"))?m.filter(e=>l(e.titulo).startsWith("[2123]")):a.includes(l("village merces cod 1377"))?m.filter(e=>l(e.titulo).startsWith("[1377]")):a.includes(l("felicita 1643"))?m.filter(e=>l(e.titulo).startsWith("[1643]")):a.includes(l("casa no cyrela ii"))?m.filter(e=>l(e.titulo).startsWith("[1031]")):a.includes(l("edificio boulevard 6162"))?m.filter(e=>l(e.titulo).startsWith("[6162]")):a.includes(l("casa b olinda"))?m.filter(e=>l(e.titulo).startsWith("[3593]")):a.includes(l("casa no pacaembu cod 1054"))?m.filter(e=>l(e.titulo).includes("leaddewhatsapp")):/^\[\d{3,}\]/.test(a)?m.filter(e=>l(e.titulo).includes(a)):m.filter(e=>{let t=l(e.titulo);return!/^\[\d{3,}\]/.test(t)&&t.includes(a)})).map(e=>({data_chegada:e.data_chegada,atividade_atual:e.atividade_atual,titulo:e.titulo})),o=r.filter(e=>"Visita Agendada"===e.atividade_atual).length;return{nome:e,nomeNorm:a,inicio:t?.inicio||"-",resultados:t?.resultados||0,custo_por_resultados:t?.custo_por_resultados||0,leads:i.length,visitas_agendadas:o,detalhes:r,origem:t?.origem||"comparacao"}}),g={resultados:h.reduce((e,t)=>e+(t.resultados||0),0),leads:h.reduce((e,t)=>e+(t.leads||0),0)};return new Response(JSON.stringify({linhas:h,debugLeads4219:f,totais:g}),{status:200})}catch(e){return new Response(JSON.stringify({error:e.message||"Erro ao processar arquivos."}),{status:500})}}let n=new r.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/compare/route",pathname:"/api/compare",filename:"route",bundlePath:"app/api/compare/route"},resolvedPagePath:"/Users/kaka/Desktop/SistemaPlanilha/src/app/api/compare/route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:d,staticGenerationAsyncStorage:c,serverHooks:p,headerHooks:m,staticGenerationBailout:f}=n,h="/api/compare/route";function g(){return(0,s.patchFetch)({serverHooks:p,staticGenerationAsyncStorage:c})}}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),i=t.X(0,[638,217],()=>a(4271));module.exports=i})();